<!DOCTYPE html>
<html>
<head>
<title>BasicGrammar.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95">基础语法</h1>
<hr>
<h2 id="%E4%BD%BF%E7%94%A8ddl%E7%AE%A1%E7%90%86%E8%A1%A8">使用ddl管理表</h2>
<p>在mysql中, 操作数据有以下三个步骤:</p>
<ol>
<li>创建数据库</li>
<li>创建表</li>
<li>crud操作</li>
</ol>
<p>根据oracle数据库体系, 有以下步骤:</p>
<ol>
<li>创建表空间</li>
<li>创建用户</li>
<li>给用户赋予权限</li>
<li>创建表</li>
<li>crud</li>
</ol>
<p>第一步: 创建一个表空间</p>
<pre class="hljs"><code><div>create tablespace water         --表空间名称
datafile 'c:/database/water'    --数据库文件
size 100M                       --表空间大小
autoextend on                   --打开自动增长
next 10M                        --每次增长多少
</div></code></pre>
<p>第二步: 创建用户</p>
<pre class="hljs"><code><div>create user frog                --用户名
identified by frog              --密码
default tablespace water        --关联表空间
</div></code></pre>
<blockquote>
<p>以上两步不能用分号</p>
</blockquote>
<p>第三步: 给用户赋予权限</p>
<pre class="hljs"><code><div>grant dba to frog;              --赋予用户dba权限
</div></code></pre>
<blockquote>
<p>dba是一组权限, 相当于system用户的权限, 是最高权限.
select * from session_privs;    可以查看当前用户的所有权限</p>
</blockquote>
<p>第四步: 创建表</p>
<p>在切换到指定的用户之后, 开始创建表:</p>
<pre class="hljs"><code><div>create table user_tbl(
       userId number(10),
       username varchar2(20)
);
</div></code></pre>
<blockquote>
<p>create关键字可以用来创建表, 视图, 用户, 表空间等所有oracle的object</p>
</blockquote>
<h2 id="oracle%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Oracle数据类型</h2>
<p>---数值<br>
number(3)   999<br>
number(3,2) 9.99</p>
<p>---字符<br>
char(10)      ---定长字符   aaa    10<br>
varchar(10)   ---可变字符   aaa    3<br>
varchar2(10)  ---使用效果和varchar 一样    推荐使用varchar2</p>
<p>---日期<br>
date  日期和时间<br>
timestamp  时间戳   秒后9位</p>
<blockquote>
<p>timestamp比date更精确, date转timestamp -- CAST(date1 AS TIMESTAMP)</p>
</blockquote>
<p>---大字段<br>
long   2G  存储的是可变长字符串<br>
clob   4G  它与LONG数据类型类似，只不过CLOB用于存储数据库中的大型单字节字符数据块，不支持宽度不等的字符集<br>
blob   4G  它用于存储数据库中的大型二进制对象</p>
<h2 id="oracle%E8%A1%A8%E7%9A%84%E7%AE%A1%E7%90%86">Oracle表的管理</h2>
<p>和mysql一样
创建表:</p>
<pre class="hljs"><code><div>create table user_tbl(
       userId number(10),
       username varchar2(20),
       age number(10)
);
</div></code></pre>
<p>修改表:</p>
<pre class="hljs"><code><div>alter table user_tbl add sex varchar2(2);	//添加列

alter table user_tbl rename column sex to gender;	//重命名列

alter table user_tbl modify gender number(1);	//修改列

alter table user_tbl drop column age;	//删除列
</div></code></pre>
<p>删除表:</p>
<pre class="hljs"><code><div>drop table user_tbl;
</div></code></pre>
<h2 id="%E7%BA%A6%E6%9D%9F">约束</h2>
<ul>
<li>主键约束 --&gt; primary key</li>
<li>非空约束 --&gt; not null</li>
<li>唯一约束 --&gt; unique</li>
<li>外键约束 --&gt; foreign key</li>
<li>检查性约束 --&gt; check</li>
</ul>
<p>创建表时添加约束:
方式一:</p>
<pre class="hljs"><code><div>create table mark(
       mid number(10) primary key,
       mark_name varchar2(100) not null unique
);

create table pig(
       pid number(10) primary key,
       pname varchar2(30) not null,
       gender number(1) check(gender in (0, 1)),
       mark_id number(10),
       constraint haha foreign key(mark_id) references mark(mid)	//外键约束只能写在这, 不能写在字段定义位置
);
</div></code></pre>
<p>方式二:</p>
<pre class="hljs"><code><div>create table mark(
       mid number(10),
       mark_name varchar2(100) not null,
       constraint primary key(mid),
       constraint c1 unique(mark_name)
);

create table pig(
       pid number(10),
       pname varchar2(30) not null,
       gender number(1),
       mark_id number(10),
       constraint p0 primary key (pid),
       constraint p1 check (gender in (0, 1)),
       constraint p2 foreign key(mark_id) references mark(mid)
);
</div></code></pre>
<p>注意事项:
如果是在创建表的时候就添加约束, 那么:</p>
<ol>
<li>not null约束只能放在字段定义处;</li>
<li>foreign key约束只能使用constraint定义, 不能放在字段定义处</li>
</ol>
<p>通过修改表添加约束:</p>
<pre class="hljs"><code><div>create table mark(
       mid number(10),
       mark_name varchar2(100)
);

alter table mark modify mid number primary key;
alter table mark modify mark_name not null unique;


create table pig(
       pid number(10),
       pname varchar2(30),
       gender number(1),
       mark_id number(10)
);

alter table pig modify pid number(10) primary key;
alter table pig modify pname varchar2(30) not null;
alter table pig modify gender number(1) check(gender in (0, 1));

--注意外键约束的添加与上面不同
alter table pig add constraint conName foreign key(mark_id) references mark(mid);
</div></code></pre>
<blockquote>
<p>删除外键约束:
alter table pig drop constraint conName;</p>
</blockquote>
<p>关于外键约束:
如果插入数据 需要先插入 主表 再插入从表
如果要删除数据  需要先删除从表 在删除主表</p>
<h2 id="%E5%A2%9E%E5%88%A0%E6%94%B9">增删改</h2>
<p>和mysql一样</p>
<h2 id="%E4%BA%8B%E5%8A%A1">事务</h2>
<p>Oracle支持三种事务隔离级别: read commited, serializable, read only. oracle默认事务隔离级别是read commited;</p>
<p>oracle的事务默认是开启的, 所以需要手动提交:
commit -- 提交命令;
rollback -- 回滚命令;</p>
<ol>
<li>Read uncommitted 读未提交
公司发工资了，领导把5000元打到singo的账号上，但是该事务并未提交，而singo正好去查看账户，发现工资已经到账，是5000元整，非常高兴。
可是不幸的是，领导发现发给singo的工资金额不对，是2000元，于是迅速回滚了事务，修改金额后，将事务提交，最后singo实际的工资只有2000元，
singo空欢喜一场。</li>
</ol>
<p>总结：出现上述情况，即我们所说的脏读，两个并发的事务，“事务A：领导给singo发工资”、“事务B：singo查询工资账户”，事务B读取了事务A尚未提交的数据。</p>
<p>当隔离级别设置为Read uncommitted时，就可能出现脏读，如何避免脏读，请看下一个隔离级别。</p>
<ol start="2">
<li>Read committed 读提已交
singo拿着工资卡去消费，系统读取到卡里确实有2000元，而此时她的老婆也正好在网上转账，把singo工资卡的2000元转到另一账户，
并在singo之前提交了事务，当singo扣款时，系统检查到singo的工资卡已经没有钱，扣款失败，singo十分纳闷，明明卡里有钱，为何......</li>
</ol>
<p>总结：出现上述情况，即我们所说的不可重复读，两个并发的事务，“事务A：singo消费”、“事务B：singo的老婆网上转账”，事务A事先读取了数据，事务B紧接了更新了数据，并提交了事务，而事务A再次读取该数据时，数据已经发生了改变。</p>
<p>当隔离级别设置为Read committed时，避免了脏读，但是可能会造成不可重复读。</p>
<p>大多数数据库的默认级别就是Read committed，比如Sql Server , Oracle。如何解决不可重复读这一问题，请看下一个隔离级别。</p>
<ol start="3">
<li>Repeatable read 重复读</li>
</ol>
<p>singo的老婆工作在银行部门，她时常通过银行内部系统查看singo的信用卡消费记录。
有一天，她正在查询到singo当月信用卡的总消费金额（select sum(amount) from transaction where month = 本月）为80元，
而singo此时正好在外面胡吃海塞后在收银台买单，消费1000元，即新增了一条1000元的消费记录（insert transaction ... ），
并提交了事务，随后singo的老婆将singo当月信用卡消费的明细打印到A4纸上，却发现消费总额为1080元，singo的老婆很诧异，
以为出现了幻觉，幻读就这样产生了。</p>
<p>总结：当隔离级别设置为Repeatable read时，可以避免不可重复读。当singo拿着工资卡去消费时，一旦系统开始读取工资卡信息（即事务开始），singo的老婆就不可能对该记录进行修改，也就是singo的老婆不能在此时转账。</p>
<p>虽然Repeatable read避免了不可重复读，但还有可能出现幻读。</p>
<ol start="4">
<li>Serializable 序列化</li>
</ol>
<p>Serializable是最高的事务隔离级别，同时代价也花费最高，性能很低，一般很少使用，在该级别下，事务顺序执行，不仅可以避免脏读、不可重复读，还避免了幻像读。</p>
<p>√: 可能出现    ×: 不会出现</p>
<table>
<thead>
<tr>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read uncommitted</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>Read committed</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>Repeatable read</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>Serializable</td>
<td>×</td>
<td>×</td>
</tr>
</tbody>
</table>
<h2 id="%E8%A7%86%E5%9B%BE">视图</h2>
<p>视图就是封装了一条复杂查询语句的对象. 视图是一张虚表. 最大的特点是简化复杂的查询.</p>
<p>视图的使用场景:</p>
<ol>
<li>简化复杂查询</li>
<li>隐藏敏感信息</li>
</ol>
<p>创建视图:</p>
<pre class="hljs"><code><div>create view 视图名称 as SQL语句
</div></code></pre>
<p>创建视图之后可以将视图作为表使用:</p>
<pre class="hljs"><code><div>select * from 视图;
</div></code></pre>
<p>也可以对视图进行增删改, 但有时候需要屏蔽掉这些需求, 这时应该给视图只读.</p>
<pre class="hljs"><code><div>create view v4 as select * from v_emp with read only;
</div></code></pre>
<h2 id="%E7%B4%A2%E5%BC%95">索引</h2>
<p>索引是用于加速数据存取的数据对象. 合理的使用索引可以大大降低i/o次数, 从而提高数据访问性能.
索引是对需要生成索引的列生成一个hashtable, 提高查询速度.</p>
<ol>
<li>单列索引</li>
</ol>
<pre class="hljs"><code><div>create index 索引名 on 表名(列名);
</div></code></pre>
<ol start="2">
<li>复合索引
将两列或者多列生成单一索引.</li>
</ol>
<pre class="hljs"><code><div>create index 索引名 on 表名(列1, 列2);
</div></code></pre>
<blockquote>
<p>一个表可以有多个索引, 但是列的组合必须不同.
索引会影响插入, 修改, 删除的效率;
创建索引的前提:</p>
<ol>
<li>表查询的概率远高于增删改的概率</li>
<li>经常出现在where 条件后的字段</li>
<li>唯一性较强的字段</li>
</ol>
</blockquote>
<p>为什么in, like, or关键字的查询效率较低. 因为他们不走索引.<br>
----in  or   like  '%%'   字段*xxx   不走索引<br>
----like  'M%'  ----走索引</p>
<p>对于复合索引:<br>
select * from 表  where  列1=xxx and 列2=xxx；----效率高  走索引<br>
select * from 表  where  列2=xxx and 列1=xxx；-----效率低  不走索引</p>
<blockquote>
<p>主键约束, 唯一约束会自动创建索引</p>
</blockquote>
<h2 id="%E5%BA%8F%E5%88%97">序列</h2>
<p>mysql中主键可以设置自动增长(Auto_increment), 但是oracle中没有这个功能, 这时就需要依靠序列完成.</p>
<p>序列就是一个计数器对象, 通过手动将计数器对象的值作为主键字段的值实现自动增长.</p>
<pre class="hljs"><code><div>--创建测试表
create table se_test(
       ti number(10) primary key,
       tm varchar(20)
);

--创建序列
create sequence seq;

--手动将序列作为主键字段的值
insert into se_test values(seq.nextval, 'frog');
</div></code></pre>
<pre class="hljs"><code><div><span class="hljs-comment">------获取队列的下一个值---</span>
<span class="hljs-keyword">select</span> seq.nextval <span class="hljs-keyword">from</span> dual;
<span class="hljs-comment">-----获取队列的当前值----</span>
<span class="hljs-keyword">select</span> seq.currval <span class="hljs-keyword">from</span> dual;
</div></code></pre>
<h2 id="%E5%90%8C%E4%B9%89%E8%AF%8D">同义词</h2>
<p>同义词的用处:</p>
<ol>
<li>可以很方便的访问其他用户的数据库对象</li>
<li>缩短了对象名字的长度</li>
</ol>
<p>创建同义词:
create synonym sp for scott.emp;
相当于给scott.emp起了一个别名.</p>
<blockquote>
<p>复制表: create table emp as select * from scott.emp;</p>
</blockquote>

</body>
</html>
