<!DOCTYPE html>
<html>
<head>
<title>mybatis.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="mybatis">MyBatis</h1>
<hr>
<h2 id="%E6%A6%82%E8%BF%B0">概述</h2>
<p>MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。2013年11月迁移到Github。
MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。
Mybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。</p>
<h3 id="%E4%BC%A0%E7%BB%9Fjdbc%E7%BC%96%E7%A8%8B%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98">传统jdbc编程存在的问题</h3>
<p>传统jdbc编程步骤:</p>
<ol>
<li>加载数据库驱动</li>
<li>创建并获取数据库链接</li>
<li>创建jdbc statement对象</li>
<li>设置sql语句</li>
<li>设置sql语句中的参数(使用preparedStatement)</li>
<li>通过statement执行sql并获取结果</li>
<li>对sql执行结果进行解析处理</li>
<li>释放资源(resultSet、preparedstatement、connection)</li>
</ol>
<p>存在的问题:</p>
<ol>
<li>数据库连接创建、释放频繁造成系统资源浪费，从而影响系统性能。如果使用数据库连接池可解决此问题。</li>
<li>Sql语句在代码中硬编码，造成代码不易维护，实际应用中sql变化的可能较大，sql变动需要改变java代码。</li>
<li>使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。</li>
<li>对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。</li>
</ol>
<p>Mybatis与Hibernate的比较:</p>
<ol>
<li>MyBatis需要自己写Sql语句, Hibernate不需要</li>
<li>mybatis无法做到数据库无关性, Hibernate数据库无关性好</li>
<li>MyBatis灵活, Hibernate不灵活</li>
</ol>
<h3 id="mybatis%E6%9E%B6%E6%9E%84">mybatis架构</h3>
<p><img src="img/mybatis.png" alt="image"></p>
<ol>
<li>mybatis配置
SqlMapConfig.xml，此文件作为mybatis的全局配置文件，配置了mybatis的运行环境等信息。
mapper.xml文件即sql映射文件，文件中配置了操作数据库的sql语句。此文件需要在SqlMapConfig.xml中加载。</li>
<li>通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂</li>
<li>由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行。</li>
<li>mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。</li>
<li>Mapped Statement也是mybatis一个底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。</li>
<li>Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。</li>
<li>Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。</li>
</ol>
<h2 id="mybatis%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F">MyBatis入门程序</h2>
<h3 id="%E4%BE%9D%E8%B5%96jar%E5%8C%85">依赖jar包</h3>
<p>Mybatis核心包:mybatis-3.2.7.jar</p>
<p>依赖包: lib文件夹下的所有jar包</p>
<p>驱动包: Mysql或者oracle驱动包</p>
<h3 id="%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">核心配置文件</h3>
<p>SqlMapConfig.xml是mybatis核心配置文件，配置文件内容为数据源、事务管理。</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">configuration</span>
<span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span>
<span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">"development"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"development"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"JDBC"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">transactionManager</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"POOLED"</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driver"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"com.mysql.jdbc.Driver"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"jdbc:mysql://localhost:3306/mybatis01?characterEncoding=utf-8"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"root"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"root"</span> /&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">mappers</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"User.xml"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"mapper/UserMapper.xml"</span>/&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">mappers</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</div></code></pre>
<h3 id="sql%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6">Sql映射文件</h3>
<p>Sql映射文件是用来建立方法与Sql语句之间的映射关系的.</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span>
<span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
<span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"usersql"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findUserById"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Integer"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		select * from user where id = #{id}
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findUserLikeOne"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"String"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		select * from user where username like "%${value}%"
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findUserLikeOnePre"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"String"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		select * from user where username like "%"#{username}"%"
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
	
	
	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insertUser"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		insert into user(username, sex, address, birthday) values(#{username}, #{sex}, #{address}, #{birthday})
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insertUserReturnId"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">selectKey</span> <span class="hljs-attr">keyColumn</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">order</span>=<span class="hljs-string">"AFTER"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"int"</span>&gt;</span>
			select last_insert_id() 
		<span class="hljs-tag">&lt;/<span class="hljs-name">selectKey</span>&gt;</span>
		insert into user(username, sex, address, birthday) values(#{username}, #{sex}, #{address}, #{birthday})
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateUser"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		update user set username = #{username}, sex = #{sex}, address = #{address}, birthday = #{birthday} where id = #{id}
	<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deleteUser"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Integer"</span>&gt;</span>
		delete from user where id = #{id}
	<span class="hljs-tag">&lt;/<span class="hljs-name">delete</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</div></code></pre>
<h4 id="%E5%8D%A0%E4%BD%8D%E7%AC%A6">占位符</h4>
<p>*<code> #{}</code>表示一个占位符号, 通过<code>#{}</code>可以实现preparedStatement向占位符中设置值, 自动进行java类型和jdbc类型转换。<code>#{}</code>可以有效防止sql注入, <code>#{}</code>可以接收简单类型值或pojo属性值。 如果parameterType传输单个简单类型值，<code>#{}</code>括号中可以是value或其它名称。</p>
<ul>
<li><code>${}</code>表示拼接sql串，通过<code>${}</code>可以将parameterType 传入的内容拼接在sql中且不进行jdbc类型转换， <code>${}</code>可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，<code>${}</code>括号中只能是value。</li>
</ul>
<h4 id="parametertype%E5%92%8Cresulttype">parameterType和resultType</h4>
<ul>
<li>parameterType：指定输入参数类型，mybatis通过ognl从输入对象中获取参数值拼接在sql中。</li>
<li>resultType：指定输出结果类型，mybatis将sql查询结果的一行记录数据映射为resultType指定类型的对象。如果有多条数据，则分别进行映射，并把对象放到容器List中</li>
</ul>
<h4 id="%E5%A2%9E%E5%88%A0%E6%94%B9%E6%A0%87%E7%AD%BE">增删改标签</h4>
<p>insert, delete, update</p>
<p>insert标签下, 主键返回:
有时候, 需要在添加一条记录之后立即返回该记录的主键, 这时候需要用到主键返回方式:</p>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insertUserReturnId"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">selectKey</span> <span class="hljs-attr">keyColumn</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">keyProperty</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">order</span>=<span class="hljs-string">"AFTER"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"int"</span>&gt;</span>
			select last_insert_id() 
		<span class="hljs-tag">&lt;/<span class="hljs-name">selectKey</span>&gt;</span>
		insert into user(username, sex, address, birthday) values(#{username}, #{sex}, #{address}, #{birthday})
	<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
</div></code></pre>
<p>这里需要注意的是order的属性有两个, 分别是BEFORE, AFTER, 可以分以下几种情况讨论:</p>
<ol>
<li>mysql主键策略为自增时, 使用AFTER(因为是在插入记录后才能得知主键)</li>
<li>mysql主键策略为uuid时, 使用BEFORE(因为是先有的uuid值之后插入的记录)</li>
<li>oracle数据库使用BEFORE(因为oracle没有主键自增的策略, 需要使用序列来实现主键自增, 所以都是在插入记录之前就已经有了主键)</li>
</ol>
<blockquote>
<p>注意, 返回的主键会自动封装到输入参数相关字段中</p>
</blockquote>
<h3 id="%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2">简单的数据库查询</h3>
<p>上面配置好了核心配置文件, 同时配置好了sql映射, 就可以根据sql映射的id找到指定的sql语句并执行.</p>
<pre class="hljs"><code><div>String config = <span class="hljs-string">"SqlMapConfig.xml"</span>;
InputStream inputStream = Resources.getResourceAsStream(config);	<span class="hljs-comment">//找到指定的核心配置文件</span>

SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);	<span class="hljs-comment">//加载核心配置文件, 得到session工厂对象</span>

SqlSession session = sessionFactory.openSession();	<span class="hljs-comment">//创建一个用于和数据库交互的session</span>

List&lt;User&gt; users = session.selectList(<span class="hljs-string">"usersql.findUserLikeOne"</span>, <span class="hljs-string">"小"</span>);	<span class="hljs-comment">//执行指定的sql语句</span>

session.close();	<span class="hljs-comment">//关闭session</span>
</div></code></pre>
<ul>
<li>SqlSessionFactory --&gt; SqlSessionFactory是一个接口，接口中定义了openSession的不同重载方法，SqlSessionFactory的最佳使用范围是整个应用运行期间，一旦创建后可以重复使用，通常以单例模式管理SqlSessionFactory。</li>
<li>SqlSessionFactoryBuilder --&gt; SqlSessionFactoryBuilder用于创建SqlSessionFacoty，SqlSessionFacoty一旦创建完成就不需要SqlSessionFactoryBuilder了，因为SqlSession是通过SqlSessionFactory创建的。所以可以将SqlSessionFactoryBuilder当成一个工具类使用，最佳使用范围是方法范围即方法体内局部变量。</li>
<li>SqlSession --&gt; SqlSession是一个面向用户的接口，sqlSession中定义了数据库操作方法。每个线程都应该有它自己的SqlSession实例。SqlSession的实例不能共享使用，它也是线程不安全的。因此最佳的范围是请求或方法范围。绝对不能将SqlSession实例的引用放在一个类的静态字段或实例字段中。</li>
</ul>
<p>selectOne和selectList的区别:</p>
<ul>
<li>selectOne查询一条记录，如果使用selectOne查询多条记录则抛出异常</li>
<li>selectList可以查询一条或多条记录。</li>
</ul>
<h2 id="dao%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95">DAO开发方法</h2>
<p>上面的演示用, 通过session的方法, 区寻找指定的sql语句, 可以直接执行对应的sql语句. 但是这样不符合面向对象的编程思想, 可维护性差. 正确的方式应该是使用Dao层作为sql语句执行的层, 来进行开发.</p>
<p>Mybatis的DAO开发方式有两种:</p>
<ol>
<li>原始的Dao开发方式</li>
<li>Mapper动态代理的开发方式</li>
</ol>
<h3 id="%E5%8E%9F%E5%A7%8Bdao%E5%B1%82%E5%BC%80%E5%8F%91">原始dao层开发</h3>
<p>原始的dao层开发实际上很简单, 就是将上面直接执行sql映射中的sql语句封装到每一个dao层对应实现类指定方法中.</p>
<pre class="hljs"><code><div><span class="hljs-keyword">private</span> SqlSessionFactory sessionFactory;
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UserDaoImpl</span><span class="hljs-params">(SqlSessionFactory sessionFactory)</span></span>{
	<span class="hljs-keyword">this</span>.sessionFactory = sessionFactory;
}
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">selectOneUser</span><span class="hljs-params">(Integer id)</span> </span>{
	SqlSession session = sessionFactory.openSession();
	User user = session.selectOne(<span class="hljs-string">"usersql.findUserById"</span>, id);
	session.close();
	<span class="hljs-keyword">return</span> user;
}
...
</div></code></pre>
<p>原始dao层开发的存在的问题:</p>
<ol>
<li>Dao方法体存在重复代码：通过SqlSessionFactory创建SqlSession，调用SqlSession的数据库操作方法</li>
<li>调用sqlSession的数据库操作方法需要指定statement的id，这里存在硬编码，不便于开发维护</li>
</ol>
<h3 id="mapper%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%9A%84%E6%96%B9%E5%BC%8F">Mapper动态代理的方式</h3>
<p>采用Mapper动态代理的方式做dao层开发, dao层不需要实现类, 只需要有mapper接口(相当于dao接口)即可. 但是需要满足以下规范:</p>
<ol>
<li>XXXMapper.xml文件中的namespace与mapper接口类的全路径相同</li>
<li>Mapper接口的方法名与sql映射文件中的每一个statement的id相同</li>
<li>Mapper接口的方法的输入参数与sql映射文件中的每一个statement的parameterType类型相同</li>
<li>Mapper接口的方法的输出参数与sql映射文件中的每一个statement的resultType类型相同</li>
</ol>
<p>只要满足上面四条规范, 就可以使用下面的代码:</p>
<pre class="hljs"><code><div><span class="hljs-comment">//加载核心配置文件以及sql映射文件</span>
SqlSessionFactory sessionFactory = <span class="hljs-keyword">new</span> SqlSessionFactoryBuilder().build(Resources.getResourceAsStream(<span class="hljs-string">"sqlMapConfig.xml"</span>));
<span class="hljs-comment">//创建session</span>
SqlSession session = sessionFactory.openSession();
<span class="hljs-comment">//获取Mapper动态代理对象(有mybatis进行动态代理)</span>
UserMapper mapper = session.getMapper(UserMapper<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
<span class="hljs-comment">//执行动态代理对象的某一方法, mybatis, 根据指定的方法名, 到sql映射文件中找到指定的statement语句, 执行指定的sql语句</span>
List&lt;User&gt; users = mapper.findAll();
<span class="hljs-comment">//关闭session</span>
session.close();
</div></code></pre>
<blockquote>
<p>mybatis官方推荐使用mapper代理方法开发mapper接口，程序员不用编写mapper接口实现类，使用mapper代理方法时，输入参数可以使用pojo包装对象或map对象，保证dao的通用性。</p>
</blockquote>
<h2 id="%E5%86%8D%E8%B0%88sqlmapconfigxml%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">再谈SqlMapConfig.xml核心配置文件</h2>
<h3 id="%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9">配置内容</h3>
<p>SqlMapConfig.xml中配置的内容和顺序如下：</p>
<pre class="hljs"><code><div>properties（属性）
settings（全局配置参数）
typeAliases（类型别名）
typeHandlers（类型处理器）
objectFactory（对象工厂）
plugins（插件）
environments（环境集合属性对象）
	environment（环境子属性对象）
		transactionManager（事务管理）
		dataSource（数据源）
mappers（映射器）
</div></code></pre>
<blockquote>
<p>注意： MyBatis 将按照下面的顺序来加载属性</p>
</blockquote>
<ul>
<li>properties属性: 可以引用java属性文件中的配置信息
例如, 有db.properties配置文件:<pre class="hljs"><code><div>	<span class="hljs-meta">jdbc.driver</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span>
	<span class="hljs-meta">jdbc.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8</span>
	<span class="hljs-meta">jdbc.username</span>=<span class="hljs-string">root</span>
	<span class="hljs-meta">jdbc.password</span>=<span class="hljs-string">root</span>
</div></code></pre>
则properties中可以这样配置:<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">properties</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"db.properties"</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- 在properties内部用property定义属性 --&gt;</span>
		<span class="hljs-comment">&lt;!-- 如果外部配置文件有该属性，则内部定义属性被外部属性覆盖 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"jdbc.username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"root123"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"jdbc.password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"root123"</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">environments</span> <span class="hljs-attr">default</span>=<span class="hljs-string">"development"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">environment</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"development"</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- 使用jdbc事务管理 --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">transactionManager</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"JDBC"</span> /&gt;</span>
			<span class="hljs-comment">&lt;!-- 数据库连接池 --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">dataSource</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"POOLED"</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driver"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.driver}"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.url}"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.username}"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.password}"</span> /&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">dataSource</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">environment</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">environments</span>&gt;</span>
</div></code></pre>
</li>
</ul>
<blockquote>
<p>在 properties 元素体内定义的属性首先被读取。
然后会读取properties 元素中resource或 url 加载的属性，它会覆盖已读取的同名属性。</p>
</blockquote>
<ul>
<li>typeAliases(类型别名) Mybatis内部已经定的别名有Integer, int等等, 所以使用这些类型时不用使用全限定名. 我们可以为自己创建的类起别名.<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">typeAliases</span>&gt;</span>
		<span class="hljs-comment">&lt;!-- 单个别名定义 --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">typeAlias</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"user"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"cn.itcast.mybatis.pojo.User"</span> /&gt;</span>
		<span class="hljs-comment">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（大小写不敏感） --&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"cn.itcast.mybatis.pojo"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">package</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"其它包"</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">typeAliases</span>&gt;</span>
</div></code></pre>
</li>
</ul>
<blockquote>
<p>这样在mapper.xml配置文件中，就可以使用设置的别名了. 别名大小写不敏感, 例如iNT是对的.</p>
</blockquote>
<ul>
<li>mappers(映射器): 用于配置sql映射位置, 以便于读取映射文件, 配置方式有多种:
<ol>
<li>使用相对类路径的资源: <mapper resource="sqlmap/User.xml" /></li>
<li>使用mapper接口类: <mapper class="sch.frog.mybatis.mapper.UserMapper" />
此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。</li>
<li>注册指定包下的所有mapper接口:<package name="sch.frog.mybatis.mapper"/> (开发常用的方式)
此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中.</li>
</ol>
</li>
</ul>
<p>以下采用包扫描的方式来配置sql映射.</p>
<h2 id="%E8%BE%93%E5%85%A5%E6%98%A0%E5%B0%84%E5%92%8C%E8%BE%93%E5%87%BA%E6%98%A0%E5%B0%84">输入映射和输出映射</h2>
<p>Mapper.xml映射文件中定义了操作数据库的sql，每个sql是一个statement，映射文件是mybatis的核心。</p>
<h3 id="parametertype%E8%BE%93%E5%85%A5%E7%B1%BB%E5%9E%8B">parameterType输入类型</h3>
<ol>
<li>传递简单类型
使用#{}占位符，或者${}进行sql拼接</li>
<li>传递pojo对象
Mybatis使用ognl表达式解析对象字段的值，#{}或者${}括号中的值为pojo属性名称。</li>
<li>传递pojo包装对象
查询条件可能是综合的查询条件，不仅包括用户查询条件还包括其它的查询条件（比如查询用户信息的时候，将用户购买商品信息也作为查询条件），这时可以使用包装对象传递输入参数. 包装对象：Pojo类中的一个属性是另外一个pojo</li>
</ol>
<h3 id="resulttype%E8%BE%93%E5%87%BA%E7%B1%BB%E5%9E%8B">resultType输出类型</h3>
<ol>
<li>输出简单类型</li>
<li>输出pojo对象 -- 单个对象</li>
<li>输出pojo列表 -- list</li>
</ol>
<h3 id="resultmap%E8%BE%93%E5%87%BA%E7%B1%BB%E5%9E%8B">resultMap输出类型</h3>
<p>resultType可以指定将查询结果映射为pojo，但需要pojo的属性名和sql查询的列名一致方可映射成功。
如果sql查询字段名和pojo的属性名不一致，可以通过resultMap将字段名和属性名作一个对应关系 ，resultMap实质上还需要将查询结果映射到pojo对象中。resultMap可以实现将查询结果映射为复杂类型的pojo，比如在查询结果映射对象中包括pojo和list实现一对一查询和一对多查询。</p>
<p>举例:</p>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"sch.frog.pojo.Order"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"OrderMap"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/&gt;</span>
		<span class="hljs-comment">&lt;!--建议加上主键id的映射, 尽管一样--&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"userId"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"user_id"</span>/&gt;</span>
		<span class="hljs-comment">&lt;!--没有指定对应映射的字段还会使用默认字段名--&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findAllOrders"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"OrderMap"</span>&gt;</span>
		select * from orders
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</div></code></pre>
<h2 id="%E5%8A%A8%E6%80%81sql">动态sql</h2>
<p>通过mybatis提供的各种标签方法实现动态拼接sql。</p>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findUserByWhere"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		select * from user
		<span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"sex != null"</span>&gt;</span>
				and sex = #{sex}
			<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"username != null and username != ''"</span>&gt;</span>
				and username like "%"#{username}"%"
			<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</div></code></pre>
<p>上面这个statement可以生成以下sql语句:</p>
<ol>
<li>select * from user</li>
<li>select * from user where sex = ?</li>
<li>select * from user where username like &quot;%&quot;?&quot;%&quot;</li>
<li>select * from user where sex = ? and username like &quot;%&quot;?&quot;%&quot;</li>
</ol>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findUserByForeach"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Integer"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		select * from user
		<span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
			<span class="hljs-comment">&lt;!-- 
				id in (1,10,26,28)
				foreach : 遍历输入参数
				collection ： 要遍历的集合名称
					当输入参数类型是数组类型时，那么collection = array
					当输入参数类型是集合类型时，那么collection = list
					当输入参数类型是POJO对象类型时，那么collection = 对象属性名
				item: 遍历的每一个元素的名称:注意：这个名称必须和后面的占位符中的参数一致
				separator: 遍历的分隔符;当遍历到最后一位时，不会帮我们添加分隔符了！
				open： 遍历的前缀
				close:遍历的后缀
			 --&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">open</span>=<span class="hljs-string">"id in("</span> <span class="hljs-attr">close</span>=<span class="hljs-string">")"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span>&gt;</span>
				#{item}
			<span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</div></code></pre>
<p>这个statement可以生成sql语句:</p>
<ol>
<li>select * from user</li>
<li>select * from user where id in (?, ?, ?, ?, ? ............)</li>
</ol>
<p>sql片段:</p>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectAll"</span>&gt;</span>
		select * from user
	<span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findOne"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Integer"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">"selectAll"</span>/&gt;</span> where id = #{value}
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</div></code></pre>
<p>上面可以拼接成select * from user where id = ?</p>
<blockquote>
<p>sql片段的作用是用来提取sql语句中的重复代码</p>
</blockquote>
<h2 id="%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84">关联映射</h2>
<p>MyBatis只能有一对多和一对一</p>
<h3 id="%E4%B8%80%E5%AF%B9%E4%B8%80">一对一</h3>
<p>一对一查询时, 主要还是对返回值封装的问题. 由于需要查询出来的值可能是两个对象中的字段, 所以需要返回对象中拥有两个对象. 有以下解决方法:</p>
<ol>
<li>使用resultType结合pojo包装类</li>
<li>使用resultMap结合pojo类, 一个pojo类中包含另一个pojo对象</li>
</ol>
<h4 id="%E4%BD%BF%E7%94%A8resulttype%E7%BB%93%E5%90%88pojo%E5%8C%85%E8%A3%85%E7%B1%BB">使用resultType结合pojo包装类</h4>
<p>pojo包装类:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderAndUser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Order</span></span>{
	<span class="hljs-keyword">private</span> String username;
	<span class="hljs-keyword">private</span> String address;
	get/set...
}
</div></code></pre>
<p>mapper:</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;OrderAndUser&gt; <span class="hljs-title">findOrderUser</span><span class="hljs-params">()</span></span>;
</div></code></pre>
<p>mapper.xml:</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findOrderAndUser"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"sch.frog.vo.OrderAndUser"</span> &gt;</span>
	select orders.id, orders.user_id as userId, orders.number, orders.createtime, 
		`user`.username, `user`.address from orders left join `user` on orders.user_id = `user`.id
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</div></code></pre>
<h4 id="%E4%BD%BF%E7%94%A8resultmap%E7%BB%93%E5%90%88pojo%E7%B1%BB%E5%AE%9E%E7%8E%B0%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2">使用resultMap结合pojo类实现关联查询</h4>
<p>pojo类:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Order</span> </span>{
	<span class="hljs-comment">// 订单id</span>
	<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> id;
	<span class="hljs-comment">// 用户id</span>
	<span class="hljs-keyword">private</span> Integer userId;
	<span class="hljs-comment">// 订单号</span>
	<span class="hljs-keyword">private</span> String number;
	<span class="hljs-comment">// 订单创建时间</span>
	<span class="hljs-keyword">private</span> Date createtime;
	<span class="hljs-comment">// 备注</span>
	<span class="hljs-keyword">private</span> String note;
	
	<span class="hljs-keyword">private</span> User user;
}
</div></code></pre>
<p>mapper.xml:</p>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"sch.frog.pojo.Order"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"OrderMap"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"userId"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"user_id"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"user"</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">"sch.frog.pojo.User"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"user_id"</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"address"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"address"</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"username"</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findOne"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Integer"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"OrderMap"</span>&gt;</span>
		SELECT
			orders.id,
			orders.user_id,
			orders.number,
			orders.createtime,
			`user`.username,
			`user`.address
		FROM
			orders
		LEFT JOIN `user` ON orders.user_id = `user`.id
		WHERE
			orders.id = #{id}
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</div></code></pre>
<p>mapper类:</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">public</span> Order <span class="hljs-title">findOne</span><span class="hljs-params">(Integer id)</span></span>;
</div></code></pre>
<h3 id="%E4%B8%80%E5%AF%B9%E5%A4%9A">一对多</h3>
<p>一对多时, 可以采用上面的第二种方式进行映射(resultMap).</p>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"sch.frog.pojo.User"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"UserWithOrders"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"username"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"birthday"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"birthday"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"sex"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"address"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"address"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"address"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"orders"</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"sch.frog.pojo.Order"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"oid"</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"number"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"number"</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"note"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"note"</span>/&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"createtime"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"createtime"</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findUserWithOrdersById"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"Integer"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"UserWithOrders"</span>&gt;</span>
		SELECT
			`user`.id,
			`user`.username,
			`user`.birthday,
			`user`.sex,
			`user`.address,
			orders.id AS oid,
			orders.number,
			orders.createtime,
			orders.note
		FROM
			`user`
		LEFT JOIN orders ON `user`.id = orders.user_id
		WHERE
			`user`.id = #{id}
	<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>	
</div></code></pre>
<p>配置如上.其余略.</p>
<blockquote>
<p>注意, 关联映射时, 想要封装到对象里的字段必须全部在resultMap中映射出来, 否则, 不会自动封装. 也就是说上面不能写成:</p>
</blockquote>
<pre class="hljs"><code><div>	<span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"sch.frog.pojo.User"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"UserWithOrders"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"orders"</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"sch.frog.pojo.Order"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"oid"</span>/&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>
</div></code></pre>
<h2 id="spring%E4%B8%8Emybatis%E6%95%B4%E5%90%88">Spring与MyBatis整合</h2>
<h3 id="%E6%95%B4%E5%90%88%E6%80%9D%E8%B7%AF">整合思路</h3>
<ol>
<li>SqlSessionFactory对象应该放到spring容器中作为单例存在</li>
<li>传统dao开发方式中, 应该从spring容器中获得sqlsession对象</li>
<li>mapper代理形式中, 应该从spring容器中直接获得mapper代理对象</li>
<li>数据库的连接以及数据库连接池事务管理都交给spring容器来完成</li>
</ol>
<p>所需jar包:
spring的jar包
Mybatis的jar包
Spring+mybatis的整合包。
Mysql的数据库驱动jar包。
数据库连接池的jar包。</p>
<h3 id="%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B">配置流程</h3>
<ol>
<li>配置数据源, 数据连接池</li>
<li>创建sqlsessionfactory</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sqlSessionFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置mybatis核心配置文件 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"configLocation"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"classpath:SqlMapConfig.xml"</span> /&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置数据源 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</div></code></pre>
<h3 id="%E4%BC%A0%E7%BB%9Fdao%E5%BC%80%E5%8F%91%E6%96%B9%E5%BC%8F">传统dao开发方式</h3>
<p>首先dao层的类继承SqlSessionDaoSupport类, 该类内部有setSqlSessionFactory方法, 并且有getSqlSession方法. 可以方便进行SqlSession的访问.</p>
<p>所以dao层这样配置:</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"UserDao"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sch.frog.dao.UserDaoImpl"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sqlSessionFactory"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"sqlSessionFactory"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</div></code></pre>
<p>其余mapper映射的配置略.
dao层代码如下:</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">findAll</span><span class="hljs-params">()</span> </span>{
	SqlSession session = getSqlSession();
	List&lt;User&gt; list = session.selectList(<span class="hljs-string">"userMapper.findAll"</span>);
	<span class="hljs-keyword">return</span> list;
}
</div></code></pre>
<p>所以, 如下测试即可:</p>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo01</span><span class="hljs-params">()</span></span>{
	ApplicationContext ac = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"applicationContext.xml"</span>);
	
	UserDao userDao = (UserDao) ac.getBean(<span class="hljs-string">"UserDao"</span>);
	List&lt;User&gt; list = userDao.findAll();
	<span class="hljs-keyword">for</span> (User user : list) {
		System.out.println(user);
	}
}
</div></code></pre>
<h3 id="mapper%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%E5%BC%80%E5%8F%91">mapper代理方式开发</h3>
<ol>
<li>配置mapper映射文件</li>
<li>编写mapper接口</li>
<li>配置applicationContext.xml</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"UserMapper"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.mapper.MapperFactoryBean"</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置Mapper接口 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"mapperInterface"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"sch.frog.mapper.UserMapper"</span> /&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置sqlSessionFactory --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sqlSessionFactory"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"sqlSessionFactory"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</div></code></pre>
<p>单元测试:</p>
<pre class="hljs"><code><div><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo02</span><span class="hljs-params">()</span></span>{
	ApplicationContext ac = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">"applicationContext.xml"</span>);
	
	UserMapper mapper = (UserMapper) ac.getBean(<span class="hljs-string">"UserMapper"</span>);
	List&lt;User&gt; list = mapper.findAll();
	<span class="hljs-keyword">for</span> (User user : list) {
		System.out.println(user);
	}
}
</div></code></pre>
<p>上面这种配置方式, 需要读取sqlMapConfig.xml, 到里面找到映射文件. 更方便的方式是开启包扫描. 并将包扫描交给Spring来管理.</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span>
	<span class="hljs-comment">&lt;!-- 配置Mapper接口 --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basePackage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"sch.frog.mapper"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</div></code></pre>
<p>这样sqlMapConfig.xml中就不需要配置任何东西了. Spring实例化MapperScannerConfigurer对象后, 扫描指定包中所有mapper.class和mapper.xml, 并代理所有mapper对象, 使用是直接通过getBean获取即可(注: 每个mapper代理对象的id就是类名首字母小写)</p>
<p>这里最终的applicationContext.xml内容如下:</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
	<span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span> 
	<span class="hljs-attr">xmlns:p</span>=<span class="hljs-string">"http://www.springframework.org/schema/p"</span>
	<span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">"http://www.springframework.org/schema/aop"</span> 
	<span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">"http://www.springframework.org/schema/tx"</span>
	<span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context-4.0.xsd
		http://www.springframework.org/schema/aop 
		http://www.springframework.org/schema/aop/spring-aop-4.0.xsd 
		http://www.springframework.org/schema/tx 
		http://www.springframework.org/schema/tx/spring-tx-4.0.xsd
		http://www.springframework.org/schema/util 
		http://www.springframework.org/schema/util/spring-util-4.0.xsd"</span>&gt;</span>

	<span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"classpath:db.properties"</span> /&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.apache.commons.dbcp.BasicDataSource"</span>
		<span class="hljs-attr">destroy-method</span>=<span class="hljs-string">"close"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driverClassName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.driver}"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.url}"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.username}"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${jdbc.password}"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxActive"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"10"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxIdle"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"5"</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sqlSessionFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"configLocation"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"classpath:SqlMapConfig.xml"</span> /&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basePackage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"sch.frog.mapper"</span> /&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span>&gt;</span>
</div></code></pre>
<h2 id="mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B">MyBatis逆向工程</h2>
<p>使用官方网站的Mapper自动生成工具mybatis-generator-core-1.3.2来生成po类和Mapper映射文件</p>
<p>仅仅是一个工具, 用于快速生成常用mapper的.</p>
<p>项目已经搭建好. 只需要更改:</p>
<ol>
<li>数据源</li>
<li>mapper.xml生成位置</li>
<li>mapper.java生成位置</li>
<li>pojo生成位置</li>
<li>需要生成文件的数据库表</li>
</ol>
<p>即可, 最终生成4个文件:</p>
<ol>
<li>mapper.java</li>
<li>mapper.xml</li>
<li>pojo.java</li>
<li>pojoExample.java</li>
</ol>
<p>在mapper.java中会生成常用的增删改查方法:
例如:</p>
<pre class="hljs"><code><div><span class="hljs-function">List&lt;User&gt; <span class="hljs-title">selectByExample</span><span class="hljs-params">(UserExample example)</span></span>;
<span class="hljs-function">User <span class="hljs-title">selectByPrimaryKey</span><span class="hljs-params">(Integer id)</span></span>;
</div></code></pre>
<p>其中selectByPrimaryKey是根据主键id查询记录, selectByExample是条件查询, 如果example为null就是查询所有.</p>
<h2 id="mybatis%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E4%BC%A0%E9%80%92%E5%A4%9A%E4%B8%AA%E5%BD%A2%E5%8F%82">MyBatis一个方法传递多个形参</h2>
<p>直接上例程, 不用再添加任何配置, 配置mapper扫描即可. 关键是@Param注解</p>
<pre class="hljs"><code><div><span class="hljs-function">List&lt;Customer&gt; <span class="hljs-title">findForPageWithQueryVO</span><span class="hljs-params">(@Param(<span class="hljs-string">"pageVo"</span>)</span> Page&lt;Customer&gt; pageVo, @<span class="hljs-title">Param</span><span class="hljs-params">(<span class="hljs-string">"queryVo"</span>)</span>QueryVo queryVo)</span>;
</div></code></pre>
<p>对应mapper文件:</p>
<pre class="hljs"><code><div><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findForPageWithQueryVO"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"customer"</span>&gt;</span>
	SELECT
		customer.cust_id,
		customer.cust_name,
		customer.cust_phone,
		customer.cust_mobile,
		b1.dict_item_name as cust_source,
		b2.dict_item_name as cust_industry,
		b3.dict_item_name as cust_level
	FROM
		customer
	LEFT JOIN base_dict b1 ON customer.cust_source = b1.dict_id
	LEFT JOIN base_dict b2 ON customer.cust_industry = b2.dict_id
	LEFT JOIN base_dict b3 ON customer.cust_level = b3.dict_id
	<span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"queryVo.custName != null and queryVo.custName != ''"</span>&gt;</span>
			AND cust_name like "%"#{queryVo.custName}"%"
		<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"queryVo.custSource != null and queryVo.custSource != ''"</span>&gt;</span>
			AND b1.dict_id = #{queryVo.custSource}
		<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"queryVo.custIndustry != null and queryVo.custIndustry != ''"</span>&gt;</span>
			AND b2.dict_id = #{queryVo.custIndustry}
		<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"queryVo.custLevel != null and queryVo.custLevel != ''"</span>&gt;</span>
			AND b3.dict_id = #{queryVo.custLevel}
		<span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span>
	LIMIT #{pageVo.start}, #{pageVo.pageSize}
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
</div></code></pre>

</body>
</html>
