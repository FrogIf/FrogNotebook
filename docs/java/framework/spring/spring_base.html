<!DOCTYPE html><html><head>
      <title>spring_base</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\frogif\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.15\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="spring基础知识">Spring基础知识 </h1>
<h2 id="概述">概述 </h2>
<ul>
<li>IOC -- Inversion Of Control, 控制反转. 传统程序中, 应用程序控制着对象的创建和管理, IOC中, 发生反转, 对象的生命周期由Spring容器来控制;</li>
<li>AOP -- Aspect Oriented Programming, 面向切面编程.</li>
</ul>
<h2 id="ioc">IOC </h2>
<h3 id="bean注入的方式">Bean注入的方式 </h3>
<ul>
<li><code>@Autowired</code></li>
<li>JDK提供的<code>@Resource</code>和<code>@Inject</code></li>
<li>使用xml文件</li>
<li>Spring4.3开始, 如果只有一个有参构造, 当这个Bean实例化时, 会自动对构造器形参进行注入</li>
</ul>
<blockquote>
<p>Autowired是先byType再byName, 如果不存在会报错; Resource是先byName再byType, 如果匹配不到会默认null</p>
</blockquote>
<blockquote>
<p>Autowired不仅可以注入单个对象, 还能注入List, Set, array, Map; 并且注入Map时, key就是beanName</p>
</blockquote>
<h3 id="spring-bean生命周期">Spring Bean生命周期 </h3>
<p>Spring Bean生命周期按顺序如下:</p>
<ol>
<li><strong>实例化Bean</strong>: 对于BeanFactory容器, 当客户向容器请求一个尚未初始化的bean时, 或者初始化bean的时候, 需要注入另一个尚未初始化的依赖是, 容器会调用createBean进行实例化. 对于ApplicationContext容器, 当容器启动结束后, 通过BeanDefinition对象中的信息, 实例化所有的Bean.</li>
<li><strong>设置对象属性(依赖注入)</strong>: 实例化后的对象被封装在BeanWrapper对象中, 紧接着, Spring根据BeanDefinition中的信息, 以及通过BeanWrapper提供的设置属性的接口完成依赖注入.</li>
<li><strong>处理Aware接口</strong>: 接着, Spring会检测该对象是否实现了xxxAware接口, 并将相关的xxxAware实例注入给Bean:
<ul>
<li>如果这个Bean已经实现了BeanNameAware接口, 会调用它实现的setBeanName(beanId)方法, 此处beanId就是配置文件中的Bean的id值</li>
<li>如果这个Bean实现了BeanFactoryAware接口, 会调用它实现的setBeanFactory()方法, 传递的是BeanFactory</li>
<li>如果这个Bean已经实现了ApplicationContextAware接口, 会调用setApplicationContext()方法, 传入ApplicationContext</li>
</ul>
</li>
<li><strong>BeanPostProcessor</strong>: 如果想对Bean进行一些自定义的处理, 那么可以让Bean实现了BeanPostProcessor接口, 那么将会调用postProcessBeforeInitialization(obj, s)方法</li>
<li><strong>InitializingBean</strong>: 如果实现了InitializingBean, 则调用afterPropertiesSet方法</li>
<li><strong>init-method</strong>: 如果Bean在Spring配置文件中配置了init-method属性, 则会自动调用其配置的初始化方法</li>
<li><strong>BeanPostProcessor</strong>: 和上面一样, 如果实现了BeanPostProcessor接口, 将会调用postProcessorAfterInitialization(obj, s)方法; 由于这个方法是在Bean初始化结束时调用的, 所以可以被应用于内存或者缓存技术.</li>
<li><strong>注册Destruction回调</strong>: <code>AbstractAutowireCapableBeanFactory.registerDisposableBeanIfNecessary</code>中对实现了DisposableBean的类或者自定义销毁方法的的bean进行回调注册.</li>
<li><strong>DisposableBean</strong>: 当Bean不在需要时, 会经过清理阶段, 如果Bean实现了DisposableBean这个接口, 会调用其实现的destory()方法;</li>
<li><strong>destory-method</strong>: 最后, 如果这个Bean的Spring配置中配置了destory-method属性, 会自动调用其配置的销毁方法.</li>
</ol>
<blockquote>
<p>前1--8步在<code>AbstractAutowireCapableBeanFactory</code>类中, 9--10步在<code>DisposableBeanAdapter</code>类中</p>
</blockquote>
<img src="img/spring_bean_lifecycle.png" height="450px">
<p>示例代码如下(方法调用顺序与方法定义顺序一致):</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-package">package</span> <span class="token namespace">sch<span class="token punctuation">.</span>frog<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>app</span><span class="token punctuation">;</span>

<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">BeanPostProcessor</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">GlobalLifeCycleDemoBean</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postProcessBeforeInitialization : "</span> <span class="token operator">+</span> bean <span class="token operator">+</span> <span class="token string">", beanName : "</span> <span class="token operator">+</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postProcessAfterInitialization : "</span> <span class="token operator">+</span> bean <span class="token operator">+</span> <span class="token string">", beanName : "</span> <span class="token operator">+</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> bean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//---------------分割线------------------</span>

<span class="token keyword keyword-package">package</span> <span class="token namespace">sch<span class="token punctuation">.</span>frog<span class="token punctuation">.</span>learn<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>app</span><span class="token punctuation">;</span>

<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContextAware</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostConstruct</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PreDestroy</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">LifeCycleDemoBean</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">BeanNameAware</span><span class="token punctuation">,</span> <span class="token class-name">BeanClassLoaderAware</span><span class="token punctuation">,</span>
        <span class="token class-name">BeanFactoryAware</span><span class="token punctuation">,</span> <span class="token class-name">ApplicationContextAware</span><span class="token punctuation">,</span>
        <span class="token class-name">InitializingBean</span><span class="token punctuation">,</span> <span class="token class-name">DisposableBean</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-public">public</span> <span class="token class-name">LifeCycleDemoBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"contructor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">setBeanName</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"set bean name : "</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">setBeanClassLoader</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"set bean class loader : "</span> <span class="token operator">+</span> classLoader<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">setBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">BeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"set bean factory : "</span> <span class="token operator">+</span> beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">setApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">ApplicationContext</span> applicationContext<span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"set applicatoin context : "</span> <span class="token operator">+</span> applicationContext<span class="token punctuation">.</span><span class="token function">getApplicationName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 执行全局的 BeanPostProcessor.postProcessBeforeInitialization</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">postConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"PostConstruct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"afterPropertiesSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 执行全局的 BeanPostProcessor.postProcessAfterInitialization</span>

    <span class="token annotation punctuation">@PreDestroy</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">preDestory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"PreDestroy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"destroy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="循环依赖">循环依赖 </h3>
<p>两个或者多个bean之间互相依赖, 形成循环引用的情况. 如果不加以处理, 会导致应用程序启动失败. Spring引入三级缓存用以解决循环依赖.</p>
<p>限制: 1. 互相依赖的Bean必须是单例的; 2. 依赖注入的方式不能是构造函数注入(构造器循环依赖用@Lazy可以解决);</p>
<ul>
<li>singletonObjects: 一级缓存, 存储完整创建好的单例bean对象</li>
<li>earlySingletonObjects: 二级缓存, 存储尚未完全创建好的单例bean对象</li>
<li>singletonFactories: 三级缓存, 存储单例bean的创建工厂</li>
</ul>
<blockquote>
<p>bean的创建起始于<code>org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean(java.lang.Class&lt;T&gt;)</code>方法, 可以从这个方法一点点看到它的逻辑</p>
</blockquote>
<p>bean创建的流程, 上面bean生命周期中已经有了. 结合循环依赖下的三级缓存的流程如下:</p>
<p><img src="img/spring_circle_reference.png" alt="image"></p>
<p>总结就是: beanA创建阶段将自己的ObjectFactory放入三级缓存, 然后发现需要注入beanB, 触发创建beanB, 这时有需要注入beanA, 从三级缓存中取到beanA的factory, 创建beanA, 使得beanB创建成功, 继而beanA也创建成功;</p>
<blockquote>
<p>解决循环依赖一定需要三级缓存吗?<br>
答: 从上图也能看出, 只需要二级缓存也可以, 之所以使用三级缓存, 是为了考虑AOP代理对象. 正常情况下, AOP代理对象是在BeanPostProcessor.postProcessAfterInitialization阶段转换的, 如果只使用二级缓存, 就是上图中"加入三级缓存"改成"加入二级缓存", 那么就需要保证二级缓存中必须是AOP代理对象, 也就需要把所有的代理对象都提前创建出来, 这就打破了上面的BeanPostProcessor设计. 如果采用三级缓存, 只需从factory中获取对象时才需要稍微破坏一下, 其余依旧保持原样.</p>
</blockquote>
<blockquote>
<p>@Lazy是如何解决循环依赖的?<br>
答: 有Lazy注解注入的地方, 会先注入一个临时的代理对象, 在真正使用的时候, 会返回实际的对象.</p>
</blockquote>
<blockquote>
<p>SpringBoot2.6及以后的版本呢默认不支持循环依赖, 需要手动加上配置<code>spring.main.allow-circular-references=true</code>.</p>
</blockquote>
<h3 id="beanfactory和factorybean">BeanFactory和FactoryBean </h3>
<ul>
<li>BeanFactory就是Bean工厂, 是整个SpringIOC容器的一部分, 负责管理Bean的创建和生命周期; ApplicationContext就是BeanFactory的一个实现类. 常用方法例如: <code>applicationContext.getBean(name)</code>;</li>
<li>FactoryBean用于定义一个工厂Bean, 它可以产生某种类型的对象. 当Spring配置文件中定义一个Bean时, 如果这个Bean实现了FactoryBean接口, 那么FactoryBean.getObject()返回值会放入到IOC容器中.</li>
</ul>
<h3 id="bean的作用域">bean的作用域 </h3>
<p>Spring容器中的bean可以分为5个范围:</p>
<ul>
<li>singleton: 默认, 每个容器中只有一个bean的实例, 单例的模式由BeanFactory自身来维护</li>
<li>prototype: 为每一个bean请求提供一个实例</li>
<li>request: 为每一个网络请求创建一个实例, 在请求完成以后, bean会失效并被垃圾回收器回收</li>
<li>session: 与request范围类似, 确保每一个session中有一个bean实例, 在session过期之后, bean会随之失效</li>
<li>global-session: 全局作用域, global-session和Portlet应用相关. 当你的应用部署在Portlet容器中工作时, 它包含很多portlet, 如果你想要声明让所有的portlet共用全局的存储变量的话, 那么这全局变量需要存储在global-session中, 全局作用域与Servlet中的session作用域效果相同</li>
</ul>
<h3 id="让某个bean在其他另一个bean之前初始化">让某个Bean在其他另一个bean之前初始化 </h3>
<ul>
<li>使用@Autowired, 会先初始化注入的bean</li>
<li>使用@DependsOn, 指定需要先初始化某个bean</li>
<li>利用BeanFactoryPostProcessor, 在实现方法中使用beanFactory.getBean(xxx.class)触发指定bean的优先初始化</li>
</ul>
<blockquote>
<p>注意, @Order只能控制同一类型bean在集合中的顺序, 不能控制不同类型bean的初始化顺序</p>
</blockquote>
<h2 id="aop">AOP </h2>
<ul>
<li>基本概念: Aspect -- 切面; PointCut -- 切入点; Advice -- 通知; Target -- 目标对象; JoinPoint -- 连接点; Weaving -- 织入;</li>
<li>常用场景: 参数校验, 缓存, 日志打印, 事务管理.</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword keyword-public">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">OpLog</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">OpLogAspect</span><span class="token punctuation">{</span>   <span class="token comment">// 这整个类就是一个切面</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">OpLogAspect</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"@annotation(xxx.xxx.xxx.annotation.OpLog)"</span><span class="token punctuation">)</span> <span class="token comment">// 这个就是PointCut, 类似的注解还有: Pointcut, Before, After等</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token comment">/*这个就是joinPoint连接点*/</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">/*
         * 这个方法里面的内容就是Advice
         */</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span>pjp<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OpLog</span> opLog <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">OpLog</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> response <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span><span class="token punctuation">{</span>
            response <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 织入工作由Spring完成, 将切面与业务逻辑连接起来</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>AOP通知类型</strong></p>
<ul>
<li>前置通知(Before advice): 在某连接点(join point)之前执行的通知, 但这个通知不能阻止连接点前的执行(除非它抛出一个异常)</li>
<li>返回后通知(After returning advice): 在某连接点(join point)正常完成后执行的通知. 例如: 一个方法没有抛出任何异常, 正常返回</li>
<li>抛出异常后通知(After throwing advice): 在方法抛出异常退出时执行的通知</li>
<li>后通知(After (finally) advice): 当某连接点退出的时候执行的通知(不论是正常返回还是异常退出)</li>
<li>环绕通知(Around Advice): 包围一个连接点(join point)通知, 如方法调用.</li>
</ul>
<h2 id="事务">事务 </h2>
<p><strong>Spring事务种类</strong></p>
<ul>
<li>编程式事务: 使用transactionTemplate</li>
<li>声明式事务: 建立在AOP之上, 本质就是通过AOP对方法进行around</li>
</ul>
<blockquote>
<p>声明式事务的优点: 使用@Transactional注解, 侵入低, 不污染代码<br>
声明式事务的缺点: 粒度只能到方法级别, 无法做到代码块级别</p>
</blockquote>
<p>声明式事务演示:</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRED</span><span class="token punctuation">,</span> isolation <span class="token operator">=</span> <span class="token class-name">Isolation</span><span class="token punctuation">.</span><span class="token constant">DEFAULT</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">30</span> <span class="token comment">/*秒*/</span><span class="token punctuation">,</span> readOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> rollbackFor <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
</code></pre><blockquote>
<p>rollbackFor指定哪些异常会触发事务回滚, 如果不指定, 默认是RuntimeException和Error会触发事务回滚<br>
propagation用于控制多个事务方法相互调用时的事务行为, 默认是Propagation.REQUIRED</p>
</blockquote>
<p><strong>传播行为</strong></p>
<ul>
<li>REQUIRED: 如果当前没有事务, 就创建一个新事务, 如果当前存在事务, 就加入该事务</li>
<li>SUPPORTS: 支持当前事务, 如果当前存在事务, 就加入该事务, 如果当前不存在事务, 就以非事务执行</li>
<li>MANDATORY: 支持当前事务, 如果当前存在事务, 就加入该事务, 如果当前不存在事务, 就抛出异常</li>
<li>REQUIRES_NEW: 创建新事务, 无论当前存不存在事务, 都创建新事务(独立于原来的事务, 两个事务互不影响)</li>
<li>NOT_SUPPORTED: 以非事务方式执行操作, 如果当前存在事务, 就把当前事务挂起</li>
<li>NEVER: 以非事务方式执行, 如果当前存在事务, 则抛出异常</li>
<li>NESTED: 如果当前存在事务, 则在嵌套事务内执行. 如果当前没有事务, 则按REQUIRED属性执行(里面事务回滚不会影响到外面, 外面事务回滚, 里面一同回滚)</li>
</ul>
<p><strong>隔离级别</strong></p>
<ul>
<li>DEFAULT: 这是个 PlatfromTransactionManager 默认的隔离级别, 使用数据库默认的事务隔离级别</li>
<li>READ_UNCOMMITTED: 读未提交, 允许另外一个事务可以看到这个事务未提交的数据</li>
<li>READ_COMMITTED: 读已提交, 保证一个事务修改的数据提交后才能被另一事务读取, 而且能看到该事务对已有记录的更新</li>
<li>REPEATABLE_READ: 可重复读, 保证一个事务修改的数据提交后才能被另一事务读取, 但是不能看到该事务对已有记录的更新</li>
<li>SERIALIZABLE: 一个事务在执行的过程中完全看不到其他事务对数据库所做的更新</li>
</ul>
<p><strong>@Transactional事务失效</strong></p>
<ul>
<li>代理失效
<ul>
<li>@Transactional应用在非public方法上, 没法应用动态代理</li>
<li>同一个类中方法调用, 走的是this调用, 没法应用动态代理</li>
<li>final, static方法: final方法无法子类化和覆盖, 所以无法代理; static方法不属于对象, 无法AOP;</li>
<li>没有被Spring容器管理</li>
</ul>
</li>
<li>Transactional用的不对
<ul>
<li>propagation设置错误</li>
<li>rollbackFor设置错误</li>
</ul>
</li>
<li>异常被捕捉</li>
<li>事务中使用了多线程
<ul>
<li>@Transactional使用的是ThreadLocal机制来存储事务上下文(connection包含在其中), ThreadLocal是线程隔离的, 新线程中的操作不会被包含在原有事务中.</li>
</ul>
</li>
<li>数据库不支持事务</li>
</ul>
<blockquote>
<p>如果@Transactional和@Async注解加在同一个方法上, 那么事务不会失效, 但是如果@Transactional注解的方法调用了@Async的方法, @Async的方法不会触发@Transactional方法事务的回滚</p>
</blockquote>
<h2 id="设计模式">设计模式 </h2>
<ul>
<li>工厂模式: BeanFactory就是一个简单的工厂模式的体现, 用来创建对象的实例.</li>
<li>单例模式: Bean默认为单例模式.</li>
<li>代理模式: Spring的AOP功能用到了JDK的动态代理和CGLIB字节码生成技术.</li>
<li>模板方法模式: 用来解决代码重复的问题. restTemplate, jdbcTemplate</li>
<li>观察者模式: 定义对象间一种一对多的依赖关系, 当一个对象的状态发生改变时, 所有依赖它的对象都会得到通知被动更新, 例如SpringListener的实现--ApplicationListener</li>
<li>适配器模式: Spring MVC的HandlerAdapter就是适配器模式</li>
<li>责任链模式: Spring MVC拦截器</li>
</ul>
<h2 id="springmvc">SpringMVC </h2>
<p>Spring MVC是指Model-View-Controller, 即: 模型-视图-控制器.</p>
<h3 id="工作原理">工作原理 </h3>
<img src="img/spring_mvc.png" height="450px">
<ol>
<li>客户端请求, 进入DispatchServlet, 访问dispatchServlet的doService方法
<ul>
<li>DispatcherServlet就是HttpServlet的实现类(HttpServlet是java servlet API定义的处理web请求的interface).</li>
</ul>
</li>
<li>DispatchServlet根据请求信息调用HandlerMapping, 解析请求对应的Handler</li>
<li>开始执行匹配的拦截器</li>
<li>根据解析到的handler, 交由HandlerAdapter处理(HandlerAdapter内部会调用具体的Handler, 即Controller)</li>
<li>处理完成, 返回ModelAndView, Model是返回的数据对象, View是逻辑视图</li>
<li>ViewResolver会根据逻辑View查找实际的View</li>
<li>DispatcherServlet把返回的Model传给View(视图渲染)</li>
<li>把View返回给请求者</li>
</ol>
<blockquote>
<p>HandlerMapping的抽象实现AbstractHandlerMapping中有如何通过url寻找Handler的代码, 可以理解为一个map, key是url, value是handler.</p>
</blockquote>
<h3 id="如何动态添加requestmapping">如何动态添加RequestMapping* </h3>
<p>假如有这样一种场景: 需要对一个jar包进行热插拔, 当jar包加载进去之后, 就需要动态的加载RequestMapping, 如果jar包移除就需要动态的移除RequestMapping. 可以这样做:</p>
<p>动态添加RequestMapping:</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token class-name">RequestMappingHandlerMapping</span> requestMappingHandlerMapping <span class="token operator">=</span> <span class="token class-name">SpringUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">RequestMappingHandlerMapping</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> object <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 需要注册的controller</span>
<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>object <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> requestMappingHandlerMapping <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">Method</span> method <span class="token operator">=</span> requestMappingHandlerMapping<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"detectHandlerMethods"</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    method<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>requestMappingHandlerMapping<span class="token punctuation">,</span> object<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>移除RequestMapping:</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token class-name">RequestMappingHandlerMapping</span> requestMappingHandlerMapping <span class="token operator">=</span> <span class="token class-name">SpringUtil</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">RequestMappingHandlerMapping</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span> object <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 需要注册的controller</span>
requestMappingHandlerMapping<span class="token punctuation">.</span><span class="token function">getHandlerMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mappingInfo<span class="token punctuation">,</span> handlerMethod<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>handlerMethod<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        requestMappingHandlerMapping<span class="token punctuation">.</span><span class="token function">unregisterMapping</span><span class="token punctuation">(</span>mappingInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="全局异常捕捉">全局异常捕捉 </h3>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">GlobalExceptionHandler</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">GlobalExceptionHandler</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ShiroException</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">handleNoAuthException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> requestId <span class="token operator">=</span> <span class="token class-name">RequestUtil</span><span class="token punctuation">.</span><span class="token function">getRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"no auth when processing the request[{}] form action[{}]"</span><span class="token punctuation">,</span> requestId<span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token class-name">EchoErrorBuilder</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token class-name">EchoError</span><span class="token punctuation">.</span><span class="token constant">AUTH_FAILURE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"no auth"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestId</span><span class="token punctuation">(</span>requestId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">handOtherException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> response<span class="token punctuation">,</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> requestId <span class="token operator">=</span> <span class="token class-name">RequestUtil</span><span class="token punctuation">.</span><span class="token function">getRequestId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"internal exception when processing the request[{}] form action[{}]"</span><span class="token punctuation">,</span> requestId<span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token class-name">EchoErrorBuilder</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token class-name">EchoError</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"internal exception"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestId</span><span class="token punctuation">(</span>requestId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>主要是两个注解:</p>
<ul>
<li>RestControllerAdvice</li>
<li>ExceptionHandler</li>
</ul>
<h3 id="父子容器">父子容器 </h3>
<p>在传统的SSM架构中, 是存在父子容器的, 即controller层通常是子容器, service和dao是父容器, 子容器可以访问父容器, 但是父容器不能访问子容器. 现在的项目一般都是SpringBoot, 这时不论controller, service, dao都是在同一个容器中, 不存在父子容器了.</p>
<h2 id="springboot">SpringBoot </h2>
<p>SpringBoot的主要用途是实现了自动装配和自动配置. 简化了应用程序的配置和Bean的管理.</p>
<h3 id="自动配置">自动配置 </h3>
<p>通过<code>Configuration</code>, <code>Compont</code>等注解可以进行自动配置, bean注入等, 但是这个前提是, spring只会扫描启动类下面的包里的这些注解, 对于依赖的第三方jar中的Spring配置需要如何让Spring扫描到呢. 这时需要在<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>文件中添加类似配置:<code>sch.frog.custom.config.FrogCustomConfiguration</code>. Spring在启动时自动扫描classpath目录下的所有这个文件, 然后就可以加载第三方的配置了.</p>
<blockquote>
<p>旧版Spring中, 这个配置放在<code>META-INF/spring.factories</code>中, 配置形式类似: <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration=sch.frog.custom.config.FrogCustomConfiguration</code></p>
</blockquote>
<p><strong>条件化配置</strong></p>
<p>条件化配置注解有: <code>Conditional</code>, <code>ConditionalOnClass</code>, <code>ConditionalOnMissingBean</code>, <code>ConditionalOnProperty</code>等;</p>
<h3 id="启动流程">启动流程 </h3>
<p>如下是Spring Boot启动的入口:</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">SparrowApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SparrowApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>调用流程如下:</p>
<ol>
<li>创建SpringApplication实例
<ol>
<li>确定是Servlet容器还是reactive容器;</li>
<li>获取上下文初始化器<code>BootstrapRegistryInitializer</code>;</li>
<li>获取应用程序初始化器<code>ApplicationContextlnitializer</code>;</li>
<li>获取监听器<code>ApplicationListener</code>;</li>
<li>确定启动主类(这个主类并没有什么关键用途, 只是用来输出日志);</li>
</ol>
</li>
<li>执行run方法
<ol>
<li>启动计时器;</li>
<li>获取监听器, 触发<code>ApplicationStartingEvent</code>事件;</li>
<li>配置环境变量;</li>
<li>打印Banner;</li>
<li>创建<code>ApplicationContext</code>;</li>
<li>准备<code>ApplicationContext</code>, 包括加载Bean定义等;</li>
<li>刷新<code>ApplicationContext</code>, 完成Bean的创建和初始化, 以及web容器启动(详见下面)等;</li>
<li>刷新后置处理器;</li>
<li>停止计时器;</li>
<li>触发<code>ApplicationStartedEvent</code>事件;</li>
<li>调用实现了<code>CommandLineRunner</code>或<code>ApplicationRunner</code>接口的Bean.</li>
</ol>
</li>
</ol>
<p><strong>web容器的启动</strong></p>
<p>main方法中调用<code>SpringApplication.run</code> --&gt; <code>refreshContext</code> --&gt; <code>refresh</code> --&gt; <code>onRefresh</code>, 最终<code>ServletWebServerApplicationContext.onRefresh</code>中会调用<code>createWebServer</code>方法. 从而调用了内置的web容器(默认是tomcat).</p>
<p>如果不用tomcat, 改成别的, 直接将他的starter依赖引入即可, 不需要任何配置.</p>
<h3 id="优雅停机">优雅停机 </h3>
<p><strong>生成进程id</strong></p>
<p>如下代码会在spring boot启动后, 生成一个app.pid文件.</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">SparrowApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span> application <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">(</span><span class="token class-name">SparrowApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        application<span class="token punctuation">.</span><span class="token function">addListeners</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">ApplicationPidFileWriter</span><span class="token punctuation">(</span><span class="token string">"app.pid"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        application<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>之后, 在停机时, 执行: <code>cat app.pid | xargs kill</code>;</p>
<p><strong>延迟停机</strong></p>
<p>在<code>application.properties</code>配置文件中配置<code>server.shutdown=graceful</code>(默认值: <code>immediate</code>), 当服务停止时, 不再接受新的请求. 并且服务器也不会立即关闭, 而是等待正在进行的请求处理完成, 其中, 这里的等待时间可以通过<code>spring.lifecycle.timeout-per-shutdown-phase=2m</code>设置为2分钟(默认是30s)</p>
<p><strong>Actuator</strong></p>
<p>pom文件增加依赖:</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>增加配置项:</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>management.endpoint.web.exposure.include=*
management.endpoint.shutdown.enabled=true
</code></pre><p>然后就可以通过<code>curl -X POST http://localhost:8090/actuator/shutdown</code>, 实现关机.</p>
<p><strong>Shutdown Hook</strong></p>
<ul>
<li><code>DisposableBean</code>实现类的<code>destroy</code>方法;</li>
<li>有<code>PreDestroy</code>注解的方法</li>
<li>通过<code>Runtime.getRuntime().addShutdownHook(new Thread(...))</code>注册的shutdown hook</li>
<li>通过Spring事件机制注册hook:</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">TestListener</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">ApplicationListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContextClosedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">onApplicationEvent</span><span class="token punctuation">(</span><span class="token class-name">ContextClosedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="自定义starter">自定义starter </h3>
<p>starter可以作为特定功能或者组件的配置单元, 简化配置过程, 让项目轻松的重用这些功能.</p>
<ol>
<li>增加依赖:</li>
</ol>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><ol start="2">
<li>编写配置逻辑;</li>
<li>创建配置类入口文件<code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>, 并配置(详见上面的自动配置)</li>
</ol>
<h3 id="多环境配置">多环境配置 </h3>
<p>环境变量中添加: <code>SPRING_PROFILES_ACTIVE=prod</code>或者JVM参数增加<code>-Dspring.profiles.active=prod</code>;</p>
<h3 id="配置文件加载顺序">配置文件加载顺序 </h3>
<ol>
<li>默认配置(通过SpringApplication.setDefaultProperties方法设置);</li>
<li>@PropertySource注解加载的配置</li>
<li>classpath下的:
<ol>
<li>bootstrap.yml或bootstrap.properties;</li>
<li>application.yml或application.properties;</li>
<li>application-{profile}.yml或application-{profile}.properties;</li>
</ol>
</li>
<li>classpath/config下的:
<ol>
<li>bootstrap.yml或bootstrap.properties;</li>
<li>application.yml或application.properties;</li>
<li>application-{profile}.yml或application-{profile}.properties;</li>
</ol>
</li>
<li>项目根目录下:
<ol>
<li>bootstrap.yml或bootstrap.properties;</li>
<li>application.yml或application.properties;</li>
<li>application-{profile}.yml或application-{profile}.properties;</li>
</ol>
</li>
<li>项目根目录/config下:
<ol>
<li>bootstrap.yml或bootstrap.properties;</li>
<li>application.yml或application.properties;</li>
<li>application-{profile}.yml或application-{profile}.properties;</li>
</ol>
</li>
<li>操作系统环境变量等特殊配置源;</li>
<li>Servlet容器相关初始化参数;</li>
<li>SPRING_APPLICATION_JSON格式的环境变量或系统属性;</li>
<li>命令行参数;</li>
<li>测试相关的属性注入方式（如@SpringBootTest、@DynamicPropertySource和@TestPropertySource）</li>
</ol>
<blockquote>
<p>后加载的文件中的配置覆盖先加载的, 所以后加载的配置优先级高;</p>
</blockquote>
<blockquote>
<p>同类文件加载顺序: .yaml&gt;.yml&gt;.properties</p>
</blockquote>
<blockquote>
<p>如果是自定义文件名, 可以在项目启动时通过: <code>spring.config.name</code>配置文件名, 通过<code>spring.config.location</code>配置文件路径;</p>
</blockquote>
<h2 id="常用注解">常用注解 </h2>
<ul>
<li><code>@Component</code>, <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code>这几个注解都是用来声明bean的, 功能上几乎没有差异, 但是语义上存在区别;</li>
<li><code>@Bean</code>: 也是用来声明bean的, 用在方法上, 将方法的返回值放入Spring的bean容器;</li>
<li><code>@Configuration</code>: 标记一个类为配置类, 配合<code>@Bean</code>注解来管理bean的创建等;(Configuration修饰的类也会放入spring容器中)</li>
<li><code>@Configurable</code>: 这个注解不常用, 用来向普通的非Spring对象中注入Bean, 具体用法有点复杂也不常用, 这里不做介绍.</li>
<li><code>@RestController</code></li>
<li><code>@RequestMapping</code>, <code>@PostMapping</code>, <code>@GetMapping</code>, <code>@PutMapping</code>, <code>@DeleteMapping</code></li>
<li><code>@Value</code>: 设置配置值的, 示例:<code>@Value("${spring.application.name}")</code>或者<code>@Value("${spring.application.name:xxx}")</code></li>
<li><code>@Import</code>: 类注解, 用来指定将某一个或多个类的实例对象注入到spring容器中</li>
<li><code>@PropertySource</code>: 用来加载配置, 示例如下:</li>
</ul>
<pre data-role="codeBlock" data-info="" class="language-text"><code>fff.properties文件:
aaa=123

代码:

@Configuration
@PropertySource(value = "classpath:fff.properties")
public class FFFConfiguration {

    @Value("${aaa}")
    private String aaa;
}
</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>