<!DOCTYPE html>
<html>
<head>
<title>VisualBox_net.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="visualbox%E7%BD%91%E7%BB%9C">VisualBox网络</h1>
<h2 id="%E6%A6%82%E8%BF%B0">概述</h2>
<p>VirtualBox中有4中网络连接方式:</p>
<ol>
<li>NAT -- 网络地址转换模式(Network Address Translation)</li>
<li>Bridged Adapter -- 桥接</li>
<li>Internal -- 内部网络模式</li>
<li>Host-only Adapter -- 主机模式</li>
</ol>
<p>VMWare中有三种(NAT, Bridged Adapter, Host-only Adapter), Virtual Box比VM ware多了一种(Internal). 其余都是一样的.</p>
<table>
<thead>
<tr>
<th> </th>
<th>NAT</th>
<th>Bridged Adapter</th>
<th>Internal</th>
<th>Host-only Adapter</th>
</tr>
</thead>
<tbody>
<tr>
<td>虚拟机→宿主机</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>默认不能设置</td>
</tr>
<tr>
<td>宿主机→虚拟机</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>默认不能设置</td>
</tr>
<tr>
<td>虚拟机→外网</td>
<td>√</td>
<td>√</td>
<td>×</td>
<td>默认不能设置</td>
</tr>
<tr>
<td>外网→虚拟机</td>
<td>×</td>
<td>√</td>
<td>×</td>
<td>默认不能设置</td>
</tr>
<tr>
<td>虚拟机之间</td>
<td>×</td>
<td>√</td>
<td>同网络名可以</td>
<td>√</td>
</tr>
</tbody>
</table>
<h2 id="nat">NAT</h2>
<p>NAT : Network Address Translation, 网络地址转换</p>
<p>NAT模式是最简单的实现虚拟机上网的方式, 你可以这样理解:</p>
<pre class="hljs"><code><div>Guest访问网络的所有数据都是由主机提供的, Guest并不真实存在于网络中, 主机与网络中的任何机器都不能查看和访问到Guest的存在
Guest可以访问主机能访问到的所有网络, 但是对于主机以及主机网络上的其他机器, Guest又是不可见的, 甚至主机也访问不到Guest
</div></code></pre>
<p><strong>IP分配策略</strong></p>
<p>一台虚拟机的多个网卡可以被设定使用NAT, 第一个网卡连接了到专用网 10.0.2.0, 第二个网卡连接到专用网络 10.0.3.0, 等等.
默认得到的客户端ip(IP Address)是10.0.2.15, 网关(Gateway)是10.0.2.2, 域名服务器(DNS)是10.0.2.3, 可以手动进行修改.</p>
<blockquote>
<p>在做端口映射以后, 主机可以访问虚拟机</p>
</blockquote>
<p>这种方式下, 虚拟机的网卡连接到宿主的 VMnetX 上. 此时系统的 VMWare NAT Service 服务就充当了路由器的作用, 负责将虚拟机发到 VMnetX 的包进行地址转换之后发到实际的网络上, 再将实际网络上返回的包进行地址转换后通过 VMnetX 发送给虚拟机. VMWare DHCP Service 负责为虚拟机提供 DHCP 服务</p>
<h2 id="bridged-adapter">Bridged Adapter</h2>
<p>可以这样理解:</p>
<pre class="hljs"><code><div>它是通过主机网卡，架设了一条桥，直接连入到网络中了。因此，它使得虚拟机能被分配到一个网络中独立的IP，所有网络功能完全和在网络中的真实机器一样。
网桥模式下的虚拟机，你把它认为是真实计算机就行了。

这种方式下, 虚拟机就像一台真正的计算机一样, 直接连接到实际的网络上, 与宿主机没有任何联系.
</div></code></pre>
<p><strong>IP分配策略</strong></p>
<p>一般是DHCP分配的, 与主机的&quot;本地连接&quot;的IP是同一网段的. 虚拟机就能与主机互相通信</p>
<blockquote>
<p>当主机不能访问外部网络时. 虚拟机和主机之间不能相互通信. 主机的&quot;本地连接&quot;有红叉, 就不能手工指定IP. 虚拟机也不能通过DHCP得到IP地址, 手工指定IP后, 也无法与主机通信, 因为主机无IP.</p>
</blockquote>
<h2 id="internal">Internal</h2>
<p>顾名思义就是内部网络模式:</p>
<pre class="hljs"><code><div>虚拟机与外网完全断开, 只实现虚拟机于虚拟机之间的内部网络模式
</div></code></pre>
<p><strong>IP分配策略</strong></p>
<p>VirtualBox的DHCP服务器会为它分配IP, 一般得到的是192.168.56.101, 因为是从101起分的, 也可手工指定192.168.56.*</p>
<blockquote>
<p>虚拟机可以与主机的VirtualBox Host-Only Network网卡通信</p>
</blockquote>
<h2 id="host-only-adapter">Host-only Adapter</h2>
<p>主机模式, 这是一种比较复杂的模式, 需要有比较扎实的网络基础知识才能玩转. 可以说前面几种模式所实现的功能, 在这种模式下, 通过虚拟机及网卡的设置都可以被实现.</p>
<p>可以理解为:</p>
<pre class="hljs"><code><div>Guest在主机中模拟出一张专供虚拟机使用的网卡, 所有虚拟机都是连接到该网卡上的, 我们可以通过设置这张网卡来实现上网及其他很多功能, 比如(网卡共享、网卡桥接等)
</div></code></pre>
<p>虚拟机访问主机, 用的是主机的VirtualBox Host-Only Network网卡的IP: 192.168.56.1, 不管主机&quot;本地连接&quot;有无红叉, 永远通
主机访问虚拟机, 用是的虚拟机的网卡3的IP: 192.168.56.101, 不管主机“本地连接”有无红叉, 永远通
虚拟机访问互联网, 用的是自己的网卡2, 这时主机要能通过“本地连接”有线上网, (无线网卡不行)</p>
<p>这种方式下, 虚拟机的网卡连接到宿主的 VMnetX 上, 但系统并不为虚拟机提供任何路由服务, 因此虚拟机只能和宿主机进行通信, 而不能连接到实际网络上</p>
<h2 id="nat%E8%AE%BE%E7%BD%AE%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84">NAT设置端口映射</h2>
<p><strong>1. 使能访问外网</strong></p>
<p>Virtual Box安装好CentOS6之后, 网络状态如下:</p>
<p><img src="img/net_status.png" alt="image"></p>
<p>与外界完全隔离, 不能访问外网, 也不能被宿主机访问.</p>
<pre class="hljs"><code><div><span class="hljs-meta">&gt;</span><span class="bash"> vi /etc/sysconfig/network-scripts/ifcfg-eth0</span>
</div></code></pre>
<p>当前配置如下图所示:</p>
<p><img src="img/current_config.png" alt="image"></p>
<p>更改配置:</p>
<p><img src="img/config_change.png" alt="image"></p>
<p>如图所示, 有三处需要更改:</p>
<ol>
<li>Device改为与ifconfig显示的一致</li>
<li>HWADDR改为与ifconfig显示的一致</li>
<li>ONBOOT值改为yes</li>
</ol>
<p>最终配置如下:</p>
<pre class="hljs"><code><div>DEVICE=eth1
HWADDR=08:00:27:62:01:D5
TYPE=Ethernet
UUID=c1bad163-c598-4ec9-93da-777fcbc44dd9
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=dhcp
</div></code></pre>
<p>重启网卡:</p>
<pre class="hljs"><code><div>service network restart
</div></code></pre>
<p>测试一下:</p>
<pre class="hljs"><code><div>[root@localhost ~]# ifconfig
eth1      Link encap:Ethernet  HWaddr 08:00:27:62:01:D5
          inet addr:10.0.2.15  Bcast:10.0.2.255  Mask:255.255.255.0
          inet6 addr: fe80::a00:27ff:fe62:1d5/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:337 errors:0 dropped:0 overruns:0 frame:0
          TX packets:279 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:38427 (37.5 KiB)  TX bytes:46353 (45.2 KiB)
          Interrupt:19 Base address:0xd020

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 b)  TX bytes:0 (0.0 b)

[root@localhost ~]# ping www.baidu.com
PING www.a.shifen.com (180.101.49.11) 56(84) bytes of data.
64 bytes from 180.101.49.11: icmp_seq=1 ttl=43 time=28.0 ms
64 bytes from 180.101.49.11: icmp_seq=2 ttl=43 time=37.3 ms
64 bytes from 180.101.49.11: icmp_seq=3 ttl=43 time=31.4 ms
64 bytes from 180.101.49.11: icmp_seq=4 ttl=43 time=37.9 ms
64 bytes from 180.101.49.11: icmp_seq=5 ttl=43 time=33.9 ms
</div></code></pre>
<p><strong>2. 配置端口映射, 使能被宿主机访问</strong></p>
<p>为了使得宿主机可以访问到虚拟机, 需要配置端口映射.</p>
<p>配置方式如图所示:</p>
<p><img src="img/visbox_config.png" alt="image"></p>
<p>需要注意的是端口映射中GuestIP需要和虚拟机本身的IP保持一致. GuestPort需要根据需求来配置, 这里接下来需要使用终端访问虚拟机, 所以映射到22端口.</p>
<p>在宿主机上使用puTTY终端连接虚拟机:</p>
<p><img src="img/connect_by_port_map.png" alt="image"></p>
<p>连接成功:</p>
<p><img src="img/connect_success.png" alt="image"></p>
<p><strong>注意</strong></p>
<p>配置端口映射, 需要保证映射的端口在虚拟机的防火墙中是放行的:</p>
<pre class="hljs"><code><div>[root@localhost ~]# more /etc/sysconfig/iptables
<span class="hljs-meta">#</span><span class="bash"> Firewall configuration written by system-config-firewall</span>
<span class="hljs-meta">#</span><span class="bash"> Manual customization of this file is not recommended.</span>
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
COMMIT
</div></code></pre>
<p>从上面可以看出22端口是放行的.</p>
<p><strong>3. 自定义静态IP</strong></p>
<p>上面由于是动态IP, 一旦虚拟机的IP发生变化, 有会导致很多问题, 所以可以把虚拟机配置成静态IP. 这里同时演示了重新配置了虚拟机IP所处网段.</p>
<p>由于NAT模式实际上从网络上获取到的数据都是宿主机提供的, 虚拟机并不真实存在于网络当中, 所以不论如何配置IP, 都不会与外界产生IP冲突.</p>
<p><img src="img/static_ip_config.png" alt="image"></p>
<p>最终配置如下:</p>
<pre class="hljs"><code><div>DEVICE=eth1
HWADDR=08:00:27:62:01:D5
TYPE=Ethernet
UUID=c1bad163-c598-4ec9-93da-777fcbc44dd9
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=static
IPADDR=192.168.1.135
NETMASK=255.255.255.0
GATEWAY=192.168.1.1
</div></code></pre>
<blockquote>
<p>可以看出这里使用了与上面10网段完全不同的192.168网段</p>
</blockquote>
<p>重启网络服务</p>
<pre class="hljs"><code><div>service network restart
</div></code></pre>
<p>这时发现虚拟机完全不能访问外网了, 需要修改Virtual Box的网络配置:</p>
<p><img src="img/static_port_map.png" alt="image"></p>
<p>分析一下, 这个CIDR:</p>
<pre class="hljs"><code><div>CIDR, IP地址表示法是: IP地址 ::= {&lt;网络前缀&gt;， &lt;主机号&gt;} / 网络前缀所占位数
所以:
192.168.1.0 -&gt; 1100 0000 1010 1000 0000 0001 0000 0000
网络前缀是24位, 主机号8位 -&gt; 1111 1111 1111 1111 1111 1111 0000 0000 -&gt; 子网掩码 : 255.255.255.0
最大地址为 : 192.168.1.255
最小地址为 : 192.168.1.0
</div></code></pre>
<p>上面的配置可以保证虚拟机访问到外网(当然, 还需要把上面的配置应用到虚拟机上), 下面的配置是让宿主机可以访问到虚拟机, 配置端口映射:</p>
<p><img src="img/access_to_visbox.png" alt="image"></p>
<p>这里GuestIP就是虚拟机中配置的静态IP了.</p>
<p>经过上面的配置, 一个自定义的NAT network就配置好了, 下面, 将其应用到虚拟机上:</p>
<p><img src="img/apply_config_to_visbox.png" alt="image"></p>
<p>至此, 完成虚拟机静态IP配置, 并保证虚拟机可以访问到外网, 宿主机可以访问到虚拟机.</p>
<p>使用FileZilla连接试一下:</p>
<p><img src="img/port_map_test.png" alt="image"></p>
<p>没有问题.</p>
<h2 id="%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</h2>
<p>最好的效果是这样的:</p>
<ol>
<li>可以访问外网;</li>
<li>不需要配置端口映射, 就可以实现宿主机和虚拟机之间的相互访问;</li>
<li>虚拟机之间可以相互访问.</li>
</ol>
<p>对于这个, 可以采用双网卡的方案, 一张网卡采用NAT/NAT Network, 实现访问外网, 另一张网卡采用Host-Only, 实现宿主机和虚拟机之间相互访问.</p>
<p>关于NAT, 上面介绍了很多了. 这里不再赘述, NAT Network基本差不多. 这里先介绍一下Host-Only配置, 以及双网卡如何搭配使用.</p>
<p><strong>Host-Only配置</strong></p>
<p>如图, 是公共的host-only配置, 相当于新建了一个子网, 但是这个子网只有宿主机以及虚拟机直接可以访问, 对外部不可见.</p>
<p><img src="img/host-only1.png" alt="image"></p>
<p><img src="img/host-only2.png" alt="image"></p>
<blockquote>
<p>图中这个子网的网关地址是192.168.56.1, 不可修改</p>
</blockquote>
<p>最终, 我的虚拟机的网络配置如图:</p>
<p><img src="img/network_config_demo.png" alt="image"></p>
<p>系统安装完成, 启动成功之后, 就可以对这两个网卡进行配置了.</p>
<p>NAT网卡对应的配置如下, 只把ONBOOT值改成了yes:</p>
<pre class="hljs"><code><div>TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s3
UUID=1394cc23-f87d-4d05-b4a8-b74f2aba766c
DEVICE=enp0s3
ONBOOT=yes
</div></code></pre>
<p>Host-Only网卡配置如下:</p>
<pre class="hljs"><code><div>TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s8
UUID=b59b0637-7f07-4a23-9110-243f2843b4b1
DEVICE=enp0s8
ONBOOT=yes

IPADDR=192.168.56.66
NETMASK=255.255.255.0
GATEWAY=192.168.56.1
DEFROUTE=yes
IPV4_ROUTE_METRIC=199
</div></code></pre>
<p>这里, 首先把ONBOOT改成了yes, BOOTPROTO指定为static, 从而使用静态ip, 同时新增了IPADDR, NETMASK, GATEWAY, DEFROUTE, IPV4_ROUTE_METRIC配置.</p>
<p>这里需要解释一下DEFROUTE, IPV4_ROUTE_METRIC这两个配置. 访问外网需要走网关, 由于是双网卡, 所以会出现两个默认网关. 而我们访问外网应该使用NAT对应的网关, 而Host-Only的网关是不能访问外网的. 如图路由表:</p>
<p><img src="img/route_gateway.png" alt="image"></p>
<p>解释一下前两行, 前两行的Destination都是0.0.0.0, 表示目标地址是所有ip. Flags都是UG, 这里U-可达/活动; G-经由网关; H-目标是一个主机, 后面Iface列标明了使用的网卡, Metric是优先级, 越低越会优先使用. 所以前两行, 就是去往任意目标ip, 都经过10.0.3.1或者192.168.56.1网关, 这里由于上面的配置, 使得Host-Only网卡的Metric较高, 所以最终网关会使用10.0.3.1.</p>

</body>
</html>
