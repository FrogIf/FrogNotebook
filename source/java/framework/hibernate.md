# Hibernate

## Hibernate三态

1. 瞬时态

对象刚被创建但没有被持久化的话就是瞬时态
特点: 
(1) 不和 Session 实例关联
(2) 在数据库中没有和瞬时对象关联的记录

2. 持久态

持久化对象就是已经被保存进数据库的实体对象，而且这个实体对象如今还处于Hibernate的Session缓存管理之中. 这时对该实体对象的不论什么改动。都会在清理缓存时同步到数据库中。
特点:
(1) 持久的实例在数据库中有相应的记录，并拥有一个持久化标识(identifier).
(2) 和session相关联的对象

3. 游离态

当一个持久化对象，脱离开Hibernate的缓存管理后。它就处于游离状态，游离对象和自由对象的最大差别在于，游离对象在数据库中可能还存在一条与它相应的记录，仅仅是如今这个游离对象脱离了Hibernate的缓存管理，而自由对象不会在数据库中出现与它相应的数据记录。
特点:
(1) 本质上和瞬时对象同样
(2) 仅仅是比瞬时对象多了一个数据库记录标识值id

## N+1问题

N+1问题是指对于存在关联关系的数据库表, 当查询主表数据时, 会把从表数据一并查询出来. 这时存在两个问题:

1. 这个查询过程并不是关联查询, 而是先查主表1次, 查出n条数据之后, 在根据id查询从表n次, 称之为n+1.
2. 有些时候, 我们只需要主表的信息, 不需要从表的信息, 这时查询出从表信息, 就是多余的.

针对N+1问题, 解决方案有以下几个:

1. 延迟加载: 通过配置lazy策略, 使得从表信息的查询是懒加载的;
   * 但是这个只适用于load方法, 不适用于get和query, get和query依旧会立即查询.
2. 配置fetch="join", 使得采用左外连接的方式进行查询
3. 二级缓存

